var Pastease=function(){var TEST=!1,Base_url=TEST?"http://"+document.location.host:document.location.protocol+"//pastease.mopinion.com",Cookie_pro_active_days=365,LOG=!1,STREAM=!1,TRIGGERS=["passive","proactive","exit"],SERVICES=["mopinion"],USE_$=!1,AJAX_$=!1,SEPARATE_COOKIES=!0,CHECK_JOB=!0,MOPINION_VERSION="1.3",MOPINION_FILE="survey.min",USE_COLLECT=!1,SOCKET,EXIT=!1,EXIT_ACTIVATED=!1,DEBUG=!1,URL_DETECTION,OK=!1,ID,REPARSERS={},ACTIVE_RULES={},LOADED_SERVICES=[],LOCAL_FILE=null;return{load:function(id){ID=id,Pastease.debug(),Pastease.log("loading Pastea.se "+id),USE_$&&Pastease.jquery(),STREAM&&(Pastease.socketio(),SOCKET=Pastease.socket()),Pastease.check()},init:function(){Pastease.global("mopinion","version")},global:function(service,setting){var u="/global/"+service+"/"+setting,d={},f=Pastease.setGlobal,t="get";USE_$||AJAX_$?Pastease.send(u,d,f,t):Pastease.sendXML(u,d,f,t)},setGlobal:function(data){try{data=JSON.parse(data)}catch(e){Pastease.log(e)}"code"in data&&200==data.code&&(Pastease.log("Global settings:"),Pastease.log("service: "+data.service),Pastease.log("setting: "+data.setting),Pastease.log("value: "+data.value),"mopinion"==data.service&&"version"==data.setting&&(MOPINION_VERSION=data.value)),Pastease.config(ID),Pastease.log("MOPINION VERSION: "+MOPINION_VERSION)},config:function(id){var u="/config/"+id,d={},f=Pastease.parse,t="get";USE_$||AJAX_$?Pastease.send(u,d,f,t):Pastease.sendXML(u,d,f,t)},check:function(){CHECK_JOB?Pastease.sendXML("/status",{},Pastease.setStatus,"get"):Pastease.setStatus({code:200,OK:!0})},setStatus:function(data){try{data=JSON.parse(data)}catch(e){Pastease.log(e)}"code"in data&&200==data.code&&"OK"in data&&data.OK&&(OK=!0),Pastease.init(ID)},parse:function(data,update,url_change){if(!OK)return Pastease.log("Status NOT OK!"),!1;try{data=JSON.parse(data)}catch(e){Pastease.log(e)}if(!("code"in data&&200==data.code&&"deployment"in data&&"rules"in data.deployment)){Pastease.log("code: "+data.code),Pastease.log(JSON.stringify(data)),ID="";var rules=[];return!1}var rules=data.deployment.rules;if("undefined"==typeof data||void 0==data||"published"in data.deployment&&!data.deployment.published)return Pastease.log("Not published!"),!1;if("version"in data.deployment&&(MOPINION_VERSION=data.deployment.version,Pastease.log("MOPINION VERSION customized to "+MOPINION_VERSION)),"file"in data.deployment&&(MOPINION_FILE=data.deployment.file,Pastease.log("MOPINION FILE customized to "+MOPINION_FILE)),"local_file"in data.deployment&&(LOCAL_FILE=data.deployment.local_file,Pastease.log("MOPINION FILE local: "+LOCAL_FILE)),"use_collect"in data.deployment&&(USE_COLLECT=data.deployment.use_collect,Pastease.log("Use collect as survey host "+USE_COLLECT)),0==rules.length)return!1;for(var i=0;i<rules.length;i++){if(Pastease.log("============================"),Pastease.log("---RULE "+i),Pastease.log(JSON.stringify(rules[i])),!("if"in rules[i]&&"then"in rules[i]))return!1;if("id"in rules[i]&&null!=rules[i].id&&SEPARATE_COOKIES)var rule_id=rules[i].id;if(Pastease.log("RULE ID: "+rule_id),"show_form"in rules[i])var show_form=rules[i].show_form;else var show_form=null;"debug"in rules[i]&&rules[i].debug&&(DEBUG=!0);for(var if_rules=rules[i]["if"],then_rules=rules[i].then,j=0;j<if_rules.length;j++){Pastease.log("-----------------------"),Pastease.log("if rule "+j);var condition=if_rules[j];Pastease.log("condition: "+JSON.stringify(condition));var all_ok=!1,session=null;if("session"in condition)try{session=Number(condition.session)}catch(e){}Pastease.log("Condition session "+session+" days");var testedCondition=Pastease.testCondition(condition,j,rule_id,url_change);testedCondition.condition&&(all_ok=!0);for(var basic_codes=[],k=0;k<then_rules.length;k++){var service=then_rules[k];if(!("service"in service&&"args"in service))return!1;-1==LOADED_SERVICES.indexOf(service.service)&&all_ok?(LOADED_SERVICES.push(service.service),basic_codes.push(Pastease.services(service))):LOADED_SERVICES.indexOf(service.service)>-1&&all_ok&&"mopinion"==service.service&&basic_codes.push(Pastease.services(service,!0))}if(all_ok)if(update&&ACTIVE_RULES.hasOwnProperty(rule_id))Pastease.log("Just updating... Rule id: "+rule_id+" still ok.");else{ACTIVE_RULES.hasOwnProperty(rule_id)||(ACTIVE_RULES[rule_id]={}),ACTIVE_RULES[rule_id]["rule_"+j]={rules:rules[i]},Pastease.log("All OK!");var code=function(){for(var c=0;c<basic_codes.length;c++)basic_codes[c](),Pastease.log("basic code: "+basic_codes[c]);var cd=Pastease.triggers(service[["service"]],service.args,if_rules[j].trigger,if_rules[j].percentage,if_rules[j].time,session,show_form,if_rules[j].time_in_session,!1,rule_id,if_rules[j],data,"rule_"+j);cd(),Pastease.log("trigger code: "+cd),Pastease.log("triggered!")}}else{var code=function(){};if(Pastease.log("not all OK..."),Pastease.log("Rule id: "+rule_id+" not ok"),ACTIVE_RULES.hasOwnProperty(rule_id)&&ACTIVE_RULES[rule_id]["rule_"+j]&&(ACTIVE_RULES[rule_id]["rule_"+j].hasOwnProperty("timeout")&&clearTimeout(ACTIVE_RULES[rule_id]["rule_"+j].timeout),ACTIVE_RULES[rule_id]["rule_"+j].hasOwnProperty("scroll")&&"function"==typeof ACTIVE_RULES[rule_id]["rule_"+j].scroll&&Pastease.listeners().removeListener(window,"scroll",ACTIVE_RULES[rule_id]["rule_"+j].scroll),ACTIVE_RULES[rule_id]["rule_"+j].hasOwnProperty("exit")&&"function"==typeof ACTIVE_RULES[rule_id]["rule_"+j].exit&&Pastease.listeners().removeListener(document.getElementsByTagName("html")[0],"mouseleave",ACTIVE_RULES[rule_id]["rule_"+j].exit),(!ACTIVE_RULES[rule_id]["rule_"+j].triggered||url_change)&&(delete ACTIVE_RULES[rule_id]["rule_"+j],!Object.keys(ACTIVE_RULES[rule_id]).length))){var clearSrv=!0;for(var x in ACTIVE_RULES){var r=ACTIVE_RULES[x];for(var ai in r){var curRule=r[ai];if(ai!==rule_id&&curRule.initialized&&!url_change){var tempKey="";try{tempKey=curRule.rules.then[0].args[0]}catch(e){}tempKey==service.args[0]&&(clearSrv=!1)}}}clearSrv&&Pastease.clearService(service.service,service.args),delete ACTIVE_RULES[rule_id]}}all_ok&&Pastease.run(code,!0,!1)}}STREAM&&Pastease.streamInfo(),REPARSERS.set||Pastease.reparse(data)},reparse:function(data){REPARSERS.set=!0;var debouncedParse=Pastease.debounce(function(update){Pastease.parse(data,!0,update)},500);REPARSERS.forceReparse=function(){debouncedParse()},REPARSERS.mopinionShown=Pastease.listeners().addListener(document,"mopinion_shown",function(){debouncedParse()}),REPARSERS.mopinionHidden=Pastease.listeners().addListener(document,"mopinion_hidden",function(){debouncedParse()}),REPARSERS.mopinionLoaded=Pastease.listeners().addListener(document,"mopinion_loaded",function(){debouncedParse()}),URL_DETECTION||(URL_DETECTION=document.location.href);var URL_CHANGE=setInterval(function(){document.location.href!==URL_DETECTION&&(URL_DETECTION=document.location.href,debouncedParse(!0))},500);REPARSERS.pollURL=URL_CHANGE},forceParse:function(){return REPARSERS&&"function"==typeof REPARSERS.forceReparse?REPARSERS.forceReparse():void 0},testCondition:function(condition,j,rule_id,from_load){var all_ok=!0;if(Pastease.log("-----------------------"),(!("trigger"in condition)||TRIGGERS.indexOf(condition.trigger)<0)&&Pastease.log("WARNING: no trigger!"),"pause"in condition&&condition.pause)return Pastease.log("Condition paused"),!1;var testLocation=function(locationCondition){if("string"==typeof locationCondition&&(locationCondition={value:locationCondition}),"object"==typeof locationCondition&&"value"in locationCondition){if("operator"in locationCondition&&["exists","does not exist"].indexOf(locationCondition.operator)>-1)var operator=locationCondition.operator;else var operator="exists";var use_regex="boolean"==typeof locationCondition.regex?locationCondition.regex:!0;return Pastease.searchLocation(locationCondition.value,!1,operator,use_regex)}return!0},loc_code_ok=!0;if("location"in condition&&condition.location.length>0){var isListWithOnlyDoesNotExist=condition.location.every(function(obj){return obj instanceof Array?obj.every(function(innerObj){return"does not exist"===innerObj.operator}):"object"==typeof obj?"does not exist"===obj.operator:void 0}),someOrEvery=isListWithOnlyDoesNotExist?"every":"some";loc_code_ok=condition.location[someOrEvery](function(locationObj){return locationObj instanceof Array?locationObj.every(function(innerLocationObj){return testLocation(innerLocationObj)}):testLocation(locationObj)})}Pastease.log("location: "+loc_code_ok);var ref_code_ok=!0;if("referrer"in condition&&condition.referrer.length>0){ref_code_ok=!1,0==condition.referrer.length&&(ref_code_ok=!0);for(var p=0;p<condition.referrer.length;p++){var ref_code_ok_temp=Pastease.referrer(condition.referrer[p],!1);if(ref_code_ok_temp){ref_code_ok=!0;break}}}Pastease.log("referrer: "+ref_code_ok);var testCookie=function(cookieCondition){if(!("name"in cookieCondition&&("value"in cookieCondition||"operator"in cookieCondition)))return!0;if("operator"in cookieCondition&&["exists","does not exist","contains","matches exactly"].indexOf(cookieCondition.operator)>-1)var operator=cookieCondition.operator;else var operator=null;return null==operator?Pastease.getCookie(cookieCondition.name,!0)==cookieCondition.value:"exists"==operator?""!=Pastease.getCookie(cookieCondition.name,!0):"does not exist"==operator?""==Pastease.getCookie(cookieCondition.name,!0):"matches exactly"==operator?Pastease.getCookie(cookieCondition.name,!0)==cookieCondition.value:"contains"==operator?null!=Pastease.getCookie(cookieCondition.name,!0).match(cookieCondition.value):"does not contain"==operator?null==Pastease.getCookie(cookieCondition.name,!0).match(cookieCondition.value):void 0},cookie_code_ok=!0;"cookie"in condition&&condition.cookie.length>0&&(cookie_code_ok=condition.cookie.some(function(cookieObj){return cookieObj instanceof Array?cookieObj.every(function(innerCookieObj){return testCookie(innerCookieObj)}):testCookie(cookieObj)})),Pastease.log("cookie: "+cookie_code_ok);var testJs=function(jsCondition){if("name"in jsCondition&&("value"in jsCondition||"operator"in jsCondition)){if("operator"in jsCondition&&["exists","does not exist","contains","matches exactly","does not contain"].indexOf(jsCondition.operator)>-1)var operator=jsCondition.operator;else var operator=null;return eval(Pastease.jsVar(jsCondition.name,jsCondition.value,operator,!0))}return!0},js_code_ok=!0;"js"in condition&&condition.js.length>0&&(js_code_ok=condition.js.some(function(jsObj){return jsObj instanceof Array?jsObj.every(function(innerJsObj){return testJs(innerJsObj)}):testJs(jsObj)})),Pastease.log("js: "+js_code_ok);var testCssSelector=function(cssCondition){if("name"in cssCondition&&("value"in cssCondition||"operator"in cssCondition)){if("operator"in cssCondition&&["exists","does not exist","contains","matches exactly","does not contain"].indexOf(cssCondition.operator)>-1)var operator=cssCondition.operator;else var operator=null;return Pastease.cssSelector(cssCondition.name,cssCondition.value,operator)}return!0},css_selector_code_ok=!0;"css_selector"in condition&&condition.css_selector.length>0&&(css_selector_code_ok=condition.css_selector.some(function(cssObj){return cssObj instanceof Array?cssObj.every(function(innerCssObj){return testCssSelector(innerCssObj)}):testCssSelector(cssObj)})),Pastease.log("css_selector: "+css_selector_code_ok);var pages_code_ok=!0;pages_code_ok="number_of_pages"in condition&&"check"in condition.number_of_pages&&"amount"in condition.number_of_pages?Pastease.numberOfPages(condition.number_of_pages.check,condition.number_of_pages.amount,!1,rule_id,"rule_"+j):!0,Pastease.log("nr of pages: "+pages_code_ok+" for iteration "+j);var device_code_ok=!0;if("devices"in condition&&condition.devices.length>0){for(var show=!1,device_info=Pastease.testDevice(),q=0;q<condition.devices.length;q++)("desktop"!=condition.devices[q]||device_info.phone||device_info.seven_inch||device_info.tablet)&&("tablet"!=condition.devices[q]||device_info.tablet!==!0&&device_info.seven_inch!==!0)?"mobile"==condition.devices[q]&&device_info.phone===!0&&(show=!0):show=!0;device_code_ok=show}Pastease.log("device: "+device_code_ok);var type_code_ok=!0;type_code_ok="type"in condition&&["new","returning"].indexOf(condition.type)>-1?Pastease.type(condition.type,!1,rule_id,"rule_"+j,condition.session):!0,Pastease.log("new/returning visitor: "+type_code_ok);var date_code_ok=!0;"date"in condition&&"object"==typeof condition.date&&(condition.date.date&&["earlier","exactly","later"].indexOf(condition.date.operator)>-1?date_code_ok=Pastease.datetime("date",condition.date.date,condition.date.operator):condition.date.date&&condition.date.date2&&["between"].indexOf(condition.date.operator)>-1&&(date_code_ok=Pastease.datetime("date",condition.date.date,condition.date.operator,condition.date.date2))),Pastease.log("Date: "+date_code_ok);var clock_code_ok=!0;if("clock"in condition&&"object"==typeof condition.clock&&(condition.clock.time&&["earlier","exactly","later"].indexOf(condition.clock.operator)>-1?clock_code_ok=Pastease.datetime("time",condition.clock.time,condition.clock.operator):condition.clock.time&&condition.clock.time2&&["between"].indexOf(condition.clock.operator)>-1&&(clock_code_ok=Pastease.datetime("time",condition.clock.time,condition.clock.operator,condition.clock.time2))),Pastease.log("Clock: "+clock_code_ok),"scrollpos"in condition&&"from"in condition.scrollpos&&"px"in condition.scrollpos)var set_scroll=!0;else var set_scroll=!1;var condition_ok=loc_code_ok&&ref_code_ok&&cookie_code_ok&&js_code_ok&&pages_code_ok&&device_code_ok&&type_code_ok&&css_selector_code_ok&&date_code_ok&&clock_code_ok;return{condition:condition_ok,scroll:set_scroll}},run:function(code,try_catch,return_code){if(DEBUG)Pastease.log("DEBUG MODE, code will not be executed");else if(try_catch="undefined"==typeof try_catch?!1:try_catch)try{return_code?(Pastease.log("code: "+code),eval(code)):code()}catch(e){Pastease.log(e)}else return_code?(Pastease.log("code: "+code),eval(code)):code()},searchLocation:function(s,return_code,operator,use_regex){return return_code="undefined"==typeof return_code?!0:return_code,return_code?'(document.location.host+document.location.pathname+location.search+location.hash).match("'+s+'") != null':use_regex?"exists"==operator?null!=(document.location.host+document.location.pathname+location.search+location.hash).match(s):null==(document.location.host+document.location.pathname+location.search+location.hash).match(s):"exists"==operator?(document.location.host+document.location.pathname+location.search+location.hash).indexOf(s)>-1:(document.location.host+document.location.pathname+location.search+location.hash).indexOf(s)<0},referrer:function(s,return_code){return return_code="undefined"==typeof return_code?!0:return_code,return_code?'(document.referrer).match("'+s+'") != null':null!=document.referrer.match(s)},jsVar:function(name,value,operator,return_code){return return_code="undefined"==typeof return_code?!0:return_code,null==operator?return_code?"(typeof "+name+' !== "undefined" && '+name+' == "'+value+'")':"undefined"!=typeof name&&name==value:"exists"==operator?return_code?"(typeof "+name+' !== "undefined")':"undefined"!=typeof name:"does not exist"==operator?return_code?"(typeof "+name+' === "undefined")':"undefined"==typeof name:"matches exactly"==operator?return_code?"(typeof "+name+' !== "undefined" && '+name+' == "'+value+'")':"undefined"!=typeof name&&name==value:"contains"==operator?return_code?"(typeof "+name+' !== "undefined" && '+name+'.match("'+value+'"))':"undefined"!=typeof name&&null!=name.match(value):"does not contain"==operator?return_code?"(typeof "+name+' !== "undefined" && !'+name+'.match("'+value+'"))':"undefined"!=typeof name&&null==name.match(value):void 0},cssSelector:function(name,value,operator){if(!operator)return!1;var selector;try{selector=document.querySelectorAll(name)}catch(e){}if("exists"===operator){if("undefined"!=typeof selector)return selector.length>0}else if("does not exist"===operator){if("undefined"!=typeof selector)return 0===selector.length}else if("contains"===operator){if("undefined"!=typeof selector&&selector.length>0){selector=selector[0];var content=selector.textContent||selector.innerText;return value=value||"",content.match(new RegExp(value,"gi"))}}else if("matches exactly"===operator){if("undefined"!=typeof selector&&selector.length>0){selector=selector[0];var content=selector.textContent||selector.innerText;return content=content.replace(/^\s+|\s+$/g,""),value==content}}else if("does not contain"===operator&&"undefined"!=typeof selector&&selector.length>0){selector=selector[0];var content=selector.textContent||selector.innerText;return value=value||"",!content.match(new RegExp(value,"gi"))}},numberOfPages:function(check,amount,return_code,rule_id,rule_i){return return_code="undefined"==typeof return_code?!0:return_code,rule_id="undefined"==typeof rule_id?null:rule_id,amount=Number(amount),check="min"==check?">":"max"==check?"<":null,count=""!=Pastease.getCookie("page_count",!1,rule_id+rule_i)?Number(Pastease.getCookie("page_count",!1,rule_id+rule_i)):0,(""==Pastease.getCookie("last_page",!1,rule_id+rule_i)||""!=Pastease.getCookie("last_page",!1,rule_id+rule_i)&&Pastease.getCookie("last_page",!1,rule_id+rule_i)!=document.location.pathname)&&(count+=1),Pastease.setCookie("last_page",document.location.pathname+document.location.hash,0,"/",void 0,!1,rule_id+rule_i),Pastease.setCookie("page_count",count,0,"/",void 0,!1,rule_id+rule_i),null==check?!0:">"==check?count>=amount:"<"==check?count<=amount:void 0},type:function(type,return_code,rule_id,rule_i,session){return_code="undefined"==typeof return_code?!0:return_code,rule_id="undefined"==typeof rule_id?null:rule_id;var inSeconds=function(time){return Math.floor(time/1e3)},updateTimestamp=function(time){Pastease.setCookie("Pastease.session",time,session,"/",void 0,!1)},isTimestampInRange=function(){var now=inSeconds((new Date).getTime()),timestamp=Number(Pastease.getCookie("Pastease.session")),diff=now-timestamp;return 60>diff},isInFirstSession=function(){return Pastease.getCookie("Pastease.session")||updateTimestamp(inSeconds((new Date).getTime())),1==Pastease.getCookie("Pastease.returning")||1==Pastease.getCookie("Pastease.returning",!1,rule_id+rule_i)?!1:isTimestampInRange()?isTimestampInRange()?!0:void 0:(Pastease.setCookie("Pastease.returning",1),!1)};return REPARSERS.sessionPoll||(REPARSERS.sessionPoll=setInterval(function(){updateTimestamp(inSeconds((new Date).getTime()))},1e4)),"new"===type?isInFirstSession():!isInFirstSession()},datetime:function(type,datetime,operator,datetime2){if(type&&datetime&&operator){var op={earlier:function(x,y){return x>y},exactly:function(x,y){return x==y},later:function(x,y){return y>x},between:function(x,y,z){return op.later(x,z)&&op.earlier(y,z)}},date=function(date,format){if(format){var temp=date.split("/"),dd=temp[0];temp[0]=temp[1],temp[1]=dd,date=temp.join("-")}if(date)var d=new Date(date);else var d=new Date;return new Date(d.setHours(0,0,0,0)).getTime()};if("date"==type)return"between"===operator?op[operator](date(datetime,!0),date(datetime2,!0),date()):op[operator](date(datetime,!0),date());if("time"==type){var now=new Date;return now=("0"+now.getHours()).slice(-2)+":"+("0"+now.getMinutes()).slice(-2),"between"===operator?op[operator](datetime,datetime2,now):op[operator](datetime,now)}}},scroll:function(from,y,code,rule_id,rule_i){from="undefined"!==from?from:"top",perc=isNaN(y),perc&&(y=y.replace("%","")),y=parseInt(y);var code_loaded=!1,doc_height=USE_$?$(document).height():document.body.scrollHeight,win_height=USE_$?$(window).height():window.innerHeight;if(USE_$)$(window).scroll(function(){code_loaded=Pastease.onScroll(event,from,y,code,perc,code_loaded,doc_height,win_height,rule_id)});else{ACTIVE_RULES[rule_id][rule_i].scroll=Pastease.debounce(function(event){Pastease.onScroll(event,from,y,code,perc,code_loaded,doc_height,win_height,rule_id,rule_i)},200);var listeners=Pastease.listeners();listeners.addListener(window,"scroll",ACTIVE_RULES[rule_id][rule_i].scroll)}return"true"},onScroll:function(event,from,y,code,perc,code_loaded,doc_height,win_height,rule_id,rule_i){var scroll_top=USE_$?$(window).scrollTop():(window.pageYOffset||document.scrollTop)-(document.clientTop||0),scroll_top_perc=(scroll_top+win_height)/doc_height*100,scroll_bottom=doc_height-(scroll_top+win_height),scroll_bottom_perc=100-scroll_top_perc,listeners=Pastease.listeners();return Pastease.log("top: "+scroll_top),Pastease.log("top: "+scroll_top_perc+" %"),Pastease.log("bottom: "+scroll_bottom),Pastease.log("bottom: "+scroll_bottom_perc+" %"),Pastease.log("code loaded: "+code_loaded),"top"==from?!code_loaded&&(!perc&&scroll_top>=y||perc&&scroll_top_perc>=y)&&(Pastease.run(code,!1),code_loaded=!0,listeners.removeListener(window,"scroll",ACTIVE_RULES[rule_id][rule_i].scroll)):"bottom"==from&&!code_loaded&&(!perc&&y>=scroll_bottom||perc&&y>=scroll_bottom_perc)&&(Pastease.run(code,!1),code_loaded=!0,listeners.removeListener(window,"scroll",ACTIVE_RULES[rule_id][rule_i].scroll)),code_loaded},exit:function(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i){session="undefined"!=typeof session&&null!=session?session:Cookie_pro_active_days,show_form="undefined"!=typeof show_form&&null!=show_form?show_form:"once",time="undefined"!=typeof time&&null!=time?time:0,time_in_session="undefined"!=typeof time_in_session?time_in_session:null,Pastease.log("Exit activated!");var y,show_anyway="once"!=show_form?!0:!1,y_min=100,nth=Math.floor(100/perc);if(nth=isFinite(nth)?nth:0,""==Pastease.getCookie("Pastease.exit.chance",!1,rule_id)){var rnd=Pastease.rnd(nth);Pastease.setCookie("Pastease.exit.chance",rnd,session,"/",void 0,!1,rule_id)}if(!USE_$)var listeners=Pastease.listeners(),addListener=listeners.addListener,removeListener=listeners.removeListener;if(USE_$)$(document).mousemove(function(e){e=e?e:window.event,IE=document.all?!0:!1,mouseY=IE?e.clientY:e.clientY,y=mouseY});else{var moveListener=function(e){e=e?e:window.event,IE=document.all?!0:!1,mouseY=IE?e.clientY:e.clientY,Pastease.log("mouseY: "+mouseY),y=mouseY};addListener(document,"mousemove",moveListener)}time=Pastease.outAtime(time,time_in_session,"Pastease.exit.timestamp",rule_id),Pastease.log("trigger time: "+time);var INIT_TIMER=setTimeout(function(){if(Pastease.log("waiting for exit..."),USE_$)$(document).mouseleave(function(){y_min>=y&&nth==Pastease.getCookie("Pastease.exit.chance",!1,rule_id)&&(1!=Pastease.getCookie("Pastease.exit.activated",!1,rule_id)||show_anyway)&&Pastease.getExit()&&!EXIT_ACTIVATED&&(EXIT_ACTIVATED=!0,code(),Pastease.log("Oh no, left page...exit!"))});else{var html=document.getElementsByTagName("html")[0];ACTIVE_RULES[rule_id][rule_i].exit=function(){Pastease.log("y : "+y),Pastease.log("y_min : "+y_min),Pastease.log("nth : "+nth),Pastease.log("EXIT_ACTIVATED : "+EXIT_ACTIVATED),y_min>=y&&nth==Pastease.getCookie("Pastease.exit.chance",!1,rule_id)&&(1!=Pastease.getCookie("Pastease.exit.activated",!1,rule_id)||show_anyway)&&Pastease.getExit()&&!EXIT_ACTIVATED&&(EXIT_ACTIVATED=!0,Pastease.log("exit code:"),Pastease.log(code),code(),Pastease.log("Oh no, left page...exit!"),removeListener(html,"mousemove",ACTIVE_RULES[rule_id][rule_i].exit),removeListener(document,"mousemove",moveListener))},addListener(html,"mouseleave",ACTIVE_RULES[rule_id][rule_i].exit)}try{ACTIVE_RULES[rule_id][rule_i].initialized=!0}catch(e){}},time);return ACTIVE_RULES[rule_id][rule_i].timeout=INIT_TIMER,return_code?"Pastease.setExit();":Pastease.setExit},listeners:function(){var addListener,removeListener;return document.addEventListener?(addListener=function(el,evt,f){return el.addEventListener(evt,f,!1)},removeListener=function(el,evt,f){return el.removeEventListener(evt,f,!1)}):(addListener=function(el,evt,f){return el.attachEvent("on"+evt,f)},removeListener=function(el,evt,f){return el.detachEvent("on"+evt,f)}),{addListener:addListener,removeListener:removeListener}},setExit:function(b){"undefined"==typeof b&&(b=!0),EXIT=b?!0:!1},getExit:function(){return EXIT},passive:function(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i){session="undefined"!=typeof session&&null!=session?session:Cookie_pro_active_days,show_form="undefined"!=typeof show_form&&null!=show_form?show_form:"once",time="undefined"!=typeof time?time:null,time_in_session="undefined"!=typeof time_in_session?time_in_session:null,rule_id="undefined"==typeof rule_id?null:rule_id;var show_anyway="once"!=show_form?!0:!1,nth=Math.floor(100/perc);if(nth=isFinite(nth)?nth:0,""==Pastease.getCookie("Pastease.passive.chance",!1,rule_id)){var rnd=Pastease.rnd(nth);Pastease.setCookie("Pastease.passive.chance",rnd,session,"/",void 0,!1,rule_id),Pastease.setCookie("Pastease.passive.activated",0,session,"/",void 0,!1,rule_id),Pastease.log("passive condition set: 1 in "+nth+", random nr: "+rnd)}if(time=Pastease.outAtime(time,time_in_session,"Pastease.passive.timestamp",rule_id),nth!=Pastease.getCookie("Pastease.passive.chance",!1,rule_id)||1==Pastease.getCookie("Pastease.passive.activated",!1,rule_id)&&!show_anyway)if(return_code)var code2="";else var code2=function(){};else{if(return_code)var code2="var INIT_TIMER = setTimeout(function() { "+code+" }, "+time+"); ACTIVE_RULES[rule_id].timeout = INIT_TIMER;";else var code2=function(){var INIT_TIMER=setTimeout(function(){code();try{ACTIVE_RULES[rule_id][rule_i].initialized=!0}catch(e){}},time);ACTIVE_RULES[rule_id][rule_i].timeout=INIT_TIMER};Pastease.log("service starting in "+time/1e3+" seconds...")}return code2},proActive:function(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i){session="undefined"!=typeof session&&null!=session?session:Cookie_pro_active_days,show_form="undefined"!=typeof show_form&&null!=show_form?show_form:"once",time="undefined"!=typeof time?time:null,time_in_session="undefined"!=typeof time_in_session?time_in_session:null,rule_id="undefined"==typeof rule_id?null:rule_id;var show_anyway="once"!=show_form?!0:!1,nth=Math.floor(100/perc);if(nth=isFinite(nth)?nth:0,""==Pastease.getCookie("Pastease.pro_active.chance",!1,rule_id)){var rnd=Pastease.rnd(nth);Pastease.setCookie("Pastease.pro_active.chance",rnd,session,"/",void 0,!1,rule_id),Pastease.setCookie("Pastease.pro_active.activated",0,session,"/",void 0,!1,rule_id),Pastease.log("pro active condition set: 1 in "+nth+", random nr: "+rnd)}if(time=Pastease.outAtime(time,time_in_session,"Pastease.pro_active.timestamp",rule_id),nth!=Pastease.getCookie("Pastease.pro_active.chance",!1,rule_id)||1==Pastease.getCookie("Pastease.pro_active.activated",!1,rule_id)&&!show_anyway)if(return_code)var code2="";else var code2=function(){};else{if(return_code)var code2="var INIT_TIMER = setTimeout(function() { "+code+' Pastease.setCookie( "Pastease.pro_active.activated", 1, '+session+', "/", undefined, false ); }, '+time+"); ACTIVE_RULES[rule_id].timeout = INIT_TIMER;";else var code2=function(){var INIT_TIMER=setTimeout(function(){code();try{ACTIVE_RULES[rule_id][rule_i].initialized=!0}catch(e){}},time);ACTIVE_RULES[rule_id][rule_i].timeout=INIT_TIMER};Pastease.log("service starting in "+time/1e3+" seconds...")}return code2},clearService:function(service,args){if("mopinion"==service){Pastease.log("Clearing form key "+args[0]+" from service Mopinion.");try{srv.clearForm(args[0])}catch(e){}}},getActive:function(){return ACTIVE_RULES},getConfigID:function(){return ID},outAtime:function(time,time_in_session,cookie_name,rule_id){if(rule_id="undefined"==typeof rule_id?null:rule_id,null!=time_in_session&&0!=time_in_session){var timestamp=Pastease.timestamp(),prev_timestamp=""!=Pastease.getCookie(cookie_name,!1,rule_id)?Pastease.getCookie(cookie_name,!1,rule_id):timestamp,time_passed=timestamp-prev_timestamp,time=time_in_session-time_passed;Pastease.log("timestamp: "+timestamp),Pastease.log("prev_timestamp: "+prev_timestamp),Pastease.log("time_passed: "+time_passed),Pastease.log("time: "+time),""==Pastease.getCookie(cookie_name,!1,rule_id)&&Pastease.setCookie(cookie_name,timestamp,0,"/",void 0,!1,rule_id)}return 1e3*time},timestamp:function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Math.floor(Date.now()/1e3)},rnd:function(nth){return Math.floor(Math.random()*nth)+1},observer:function(){MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var observer=new MutationObserver(function(mutations,observer){Pastease.log(mutations,observer),Pastease.stream("dom",{html:document.documentElement.innerHTML})});observer.observe(document,{subtree:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0,attributeFilter:!0})},streamInfo:function(){$(document).mousemove(function(e){e=e?e:window.event,IE=document.all?!0:!1,IE?(mouseX=event.clientX,mouseY=event.clientY+document.body.scrollTop):(mouseX=e.pageX,mouseY=e.pageY),Pastease.stream("mouse",{x:mouseX,y:mouseY})}),Pastease.observer(),Pastease.stream("dom",{html:document.documentElement.innerHTML})},stream:function(t,v){try{var socket=SOCKET,o={id:Pastease.getId(),type:t,vars:v,agent:navigator.userAgent,host:document.location.host,protocol:document.location.protocol,resolution:{width:screen.width,height:screen.height},viewport:{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}};socket.emit("json",o)}catch(e){Pastease.log("stream ERROR: "+e)}Pastease.log("stream: "+JSON.stringify(o))},getId:function(){var cookie=Pastease.getCookie("stream_id");if(cookie&&""!=cookie)return cookie;var id=Pastease.randomString(30);return Pastease.setCookie("stream_id",id),id},debounce:function(func,wait,immediate){var result,timeout=null;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&(result=func.apply(context,args)),result}},randomString:function(length){return Math.round(Math.pow(36,length+1)-Math.random()*Math.pow(36,length)).toString(36).slice(1)},getCookie:function(name,trigger,rule_id){rule_id="undefined"==typeof rule_id?null:rule_id,"undefined"==typeof trigger&&(trigger=!1);var a_all_cookies=document.cookie.split(";"),a_temp_cookie="",cookie_name="",cookie_value="",b_cookie_found=!1;for(SEPARATE_COOKIES&&null!=rule_id&&!trigger&&(name+="."+rule_id),i=0;i<a_all_cookies.length;i++){if(a_temp_cookie=a_all_cookies[i].split("="),cookie_name=a_temp_cookie[0].replace(/^\s+|\s+$/g,""),cookie_name==name)return b_cookie_found=!0,a_temp_cookie.length>1&&(cookie_value=unescape(a_temp_cookie[1].replace(/^\s+|\s+$/g,""))),cookie_value;a_temp_cookie=null,cookie_name=""}return b_cookie_found?void 0:""},setCookie:function(name,value,expires,path,domain,secure,rule_id){rule_id="undefined"==typeof rule_id?null:rule_id;var today=new Date;today.setTime(today.getTime()),expires&&(expires=1e3*expires*60*60*24),SEPARATE_COOKIES&&null!=rule_id&&(name+="."+rule_id);var expires_date=new Date(today.getTime()+expires);document.cookie=name+"="+escape(value)+(expires?";expires="+expires_date.toGMTString():"")+(path?";path="+path:"")+(domain?";domain="+domain:"")+(secure?";secure":"")},makeDiv:function(div_name){if(document.getElementById(div_name))Pastease.log("Div: "+div_name+" found, nothing inserted");else{var div=document.createElement("div");div.setAttribute("id",div_name),document.getElementsByTagName("body")[0].appendChild(div),Pastease.log("inserted div: "+div_name)}},triggers:function(service,args,trigger,perc,time,session,show_form,time_in_session,return_code,rule_id,rule_data,all_data,rule_i){return_code="undefined"==typeof return_code?!0:return_code,rule_id="undefined"==typeof rule_id?null:rule_id,perc=null==perc?100:perc,time=null==time?0:time,time_in_session=null==time_in_session?0:time_in_session;var code="",scroll="object"==typeof rule_data&&"from"in rule_data.scrollpos&&"px"in rule_data.scrollpos?rule_data.scrollpos:!1,code_wrap=function(key,type,session,rule_id,show_anyway,scroll){
var exec=function(){if(1!=Pastease.getCookie("Pastease."+type+".activated",!1,rule_id)||show_anyway)var try_code=setInterval(function(){try{srv.open({key:key,trigger_method:type.replace("_",""),cookie_expire:session}),"passive"!==type&&0!==session&&Pastease.setCookie("Pastease."+type+".activated",1,session,"/",void 0,!1,rule_id),clearInterval(try_code),ACTIVE_RULES[rule_id][rule_i].triggered=!0}catch(e){Pastease.log(e)}},150)};scroll?Pastease.scroll(scroll.from,scroll.px,exec,rule_id,rule_i):exec()};if("mopinion"==service){if("passive"==trigger){if(Pastease.log("trigger: passive"),return_code)code='srv.open({key:"'+args[0]+'",trigger_method:"passive", cookie_expire:'+session+"});",code="var try_code; try_code = setInterval(function() { try { "+code+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);";else var code=function(){code_wrap(args[0],"passive",session,rule_id,show_form,scroll,all_data)};return[null,0].indexOf(time)>-1&&[null,0].indexOf(time_in_session)>-1&&[null,0].indexOf(perc)>-1?(Pastease.log("plain passive code"),code):(Pastease.log("passive code with timeout or %..."),Pastease.passive(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i))}if("proactive"==trigger){if(Pastease.log("trigger: proactive"),return_code){var code='srv.open({key:"'+args[0]+'", trigger_method:"proactive",cookie_expire:'+session+"});";code="var try_code; try_code = setInterval(function() { try { "+code+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);"}else var code=function(){code_wrap(args[0],"pro_active",session,rule_id,show_form,scroll,all_data)};return Pastease.proActive(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i)}if("exit"==trigger){if(Pastease.log("trigger: exit"),return_code){var code='srv.open({key:"'+args[0]+'", trigger_method:"exit",cookie_expire:'+session+"});";code="var try_code = setInterval(function() { try { "+code+" clearInterval(try_code); } catch(e) { Pastease.log(e); }; }, 100);"}else var code=function(){code_wrap(args[0],"exit",session,rule_id,show_form,scroll,all_data)};return Pastease.exit(perc,time,code,session,show_form,time_in_session,return_code,rule_id,rule_i)}if("test"==trigger)return Pastease.log("test trigger"),return_code?"":function(){}}},testDevice:function(){var apple_phone=/iPhone/i,apple_ipod=/iPod/i,apple_tablet=/iPad/i,android_phone=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,android_tablet=/Android/i,amazon_phone=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,amazon_tablet=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,windows_phone=/Windows Phone/i,windows_tablet=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,other_blackberry=/BlackBerry/i,other_blackberry_10=/BB10/i,other_opera=/Opera Mini/i,other_chrome=/(CriOS|Chrome)(?=.*\bMobile\b)/i,other_firefox=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,seven_inch=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),match=function(regex,userAgent){return regex.test(userAgent)},IsMobileClass=function(userAgent){var ua=userAgent||navigator.userAgent,tmp=ua.split("[FBAN");return"undefined"!=typeof tmp[1]&&(ua=tmp[0]),tmp=ua.split("Twitter"),"undefined"!=typeof tmp[1]&&(ua=tmp[0]),this.apple={phone:match(apple_phone,ua),ipod:match(apple_ipod,ua),tablet:!match(apple_phone,ua)&&match(apple_tablet,ua),device:match(apple_phone,ua)||match(apple_ipod,ua)||match(apple_tablet,ua)},this.amazon={phone:match(amazon_phone,ua),tablet:!match(amazon_phone,ua)&&match(amazon_tablet,ua),device:match(amazon_phone,ua)||match(amazon_tablet,ua)},this.android={phone:match(amazon_phone,ua)||match(android_phone,ua),tablet:!match(amazon_phone,ua)&&!match(android_phone,ua)&&(match(amazon_tablet,ua)||match(android_tablet,ua)),device:match(amazon_phone,ua)||match(amazon_tablet,ua)||match(android_phone,ua)||match(android_tablet,ua)},this.windows={phone:match(windows_phone,ua),tablet:match(windows_tablet,ua),device:match(windows_phone,ua)||match(windows_tablet,ua)},this.other={blackberry:match(other_blackberry,ua),blackberry10:match(other_blackberry_10,ua),opera:match(other_opera,ua),firefox:match(other_firefox,ua),chrome:match(other_chrome,ua),device:match(other_blackberry,ua)||match(other_blackberry_10,ua)||match(other_opera,ua)||match(other_firefox,ua)||match(other_chrome,ua)},this.seven_inch=match(seven_inch,ua),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0};return new IsMobileClass},services:function(serviceObj,init_more,return_code){return_code="undefined"==typeof return_code?!1:return_code;var service=serviceObj.service||"",args=serviceObj.args||"",disableMakeDiv=serviceObj.disableMakeDiv||!1,code="";if("mopinion"==service){if(init_more)init_more&&(code='(function() {var try_catch = setInterval(function() { try {srv.loadSurvey({key:"{0}", divName:"{2}", "use_collect": '+USE_COLLECT+"}); clearInterval(try_catch)} catch(e) {} },100)})()");else{var subdom=TEST?"accept":"collect",src=null!=LOCAL_FILE&&"undefined"!=typeof LOCAL_FILE&&void 0!=LOCAL_FILE?LOCAL_FILE:"https://"+subdom+".mopinion.com/assets/surveys/"+MOPINION_VERSION+"/js/"+MOPINION_FILE+".js?d=27112018.3";code='(function(d, e, v) {var f = d.createElement(e),vars = {"key":"{0}","domain":"{1}","divName":"{2}","button":false, "use_collect": '+USE_COLLECT+'};f.async="async";f.src = "'+src+'";f.onload = f.onreadystatechange = function() {var r = this.readyState; if (r) if (r != "complete") if (r != "loaded") return;try {srv.loadSurvey(vars);} catch (x) {}};var s = d.getElementsByTagName(e)[0],p = s.parentNode;p.insertBefore(f, s);})(document, "script", "'+MOPINION_VERSION+'");'}args.length>=3&&!disableMakeDiv&&Pastease.makeDiv(args[2])}else"CFMS"==service&&(code='Mgo.loadMopinion("mopinion","{0}","none","{1}");');for(var j=0;j<args.length;j++){var match="{"+j+"}",token=args[j];code=code.replace(match,token)}return return_code?code:function(){eval(code)}},jquery:function(){var u=document.location.protocol+"//code.jquery.com/jquery-1.9.1.js";if(Pastease.fileExists(u)===!1){var JQ=document.createElement("script");JQ.type="text/javascript",JQ.src=u,document.getElementsByTagName("head")[0].appendChild(JQ)}var checkReady=function(){window.jQuery?Pastease.log("jQuery loaded!"):window.setTimeout(function(){checkReady()},200)};checkReady()},socketio:function(){var u=document.location.protocol+"//cdn.socket.io/socket.io-1.4.5.js";if(Pastease.fileExists(u)===!1){var JQ=document.createElement("script");JQ.type="text/javascript",JQ.src=u,document.getElementsByTagName("head")[0].appendChild(JQ)}var checkReady=function(){window.io?Pastease.log("Socket.io loaded!"):window.setTimeout(function(){checkReady()},200)};checkReady()},fileExists:function(u){for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++)if(Pastease.log("looking for: "+u),Pastease.log("found: "+scripts[i].src),scripts[i].src==u)return!0;return!1},socket:function(){var host="pastea.se"==document.location.host?"socket.pastea.se":"localhost:8585";return io.connect(document.location.protocol+"//"+host)},sendXML:function(u,d,f,t){url=Base_url+u;var X=new XMLHttpRequest;X.onreadystatechange=function(){if(X.readyState==XMLHttpRequest.DONE||4==X.readyState)if(200==X.status){var data=X.responseText;f(data,!1,!0)}else Pastease.log("Ajax ERROR "+X.status)},X.open(t,url,!0),X.send()},send:function(u,d,f,t){url=Base_url+u;var options={url:url,type:t,data:d,dataType:"json",success:function(data){f(data)},error:function(data){Pastease.log("AJAX ERROR: "+JSON.stringify(data)),Pastease.log("url: "+url),Pastease.log(data,!0)}};$.ajax(options)},use$:function(s){"undefined"==typeof s&&(s=!1),USE_$=s},ajax$:function(s){"undefined"==typeof s&&(s=!1),AJAX_$=s},debug:function(s){"undefined"==typeof s&&(s=!1),LOG="true"==Pastease.getCookie("LOG")||s},log:function(s,raw){if("undefined"==typeof raw&&(raw=!1),LOG)try{console.log(raw?s:"P> "+s)}catch(e){}}}}();